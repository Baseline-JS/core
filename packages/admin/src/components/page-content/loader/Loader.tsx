import React, { useEffect, useState } from 'react';
import styles from './Loader.module.scss';

interface Props {
  isLoading?: boolean;
  hasStartedLoading?: boolean;
}

const Loader = (props: Props): JSX.Element => {
  const [isLoadingTextShowing, setIsLoadingTextShowing] = useState(false);
  const [isLoaderShowing, setIsLoaderShowing] = useState(false);
  const [loadingTimeout, setLoadingTimeout] = useState<unknown>();
  const { isLoading, hasStartedLoading } = props;

  useEffect(() => {
    if (hasStartedLoading) {
      setIsLoaderShowing(true);
      setLoadingTimeout(
        setTimeout(() => {
          setIsLoadingTextShowing(true);
        }, 250),
      );
    }
  }, [hasStartedLoading]);

  useEffect(() => {
    if (hasStartedLoading && !isLoading) {
      setIsLoadingTextShowing(false);
      setIsLoaderShowing(false);
      clearTimeout(loadingTimeout as NodeJS.Timeout);
    }
  }, [hasStartedLoading, isLoading, loadingTimeout]);

  return (
    <div
      className={`${styles.loader} ${
        isLoadingTextShowing ? styles.textVisible : ''
      } ${isLoaderShowing ? styles.visible : ''}`}
    >
      {isLoadingTextShowing ? (
        <>
          <svg width="77" height="81" xmlns="http://www.w3.org/2000/svg">
            <g>
              <path
                fill="#ffd600"
                d="M2.791 25.101c6.527 3.225 12.977 6.45 19.427 9.675l13.9 6.911a3.78 3.78 0 0 0 1.305.461c.23.077.384.154.614.23l.23.077.23-.077c.23-.077.384-.154.614-.23.498-.145.986-.325 1.459-.538 5.068-2.534 10.136-5.068 15.2-7.525 6.066-2.995 12.209-6.066 18.275-9.061a4.186 4.186 0 0 0 2.615-3.689 3.961 3.961 0 0 0-2.611-3.839l-9.522-4.761C56.695 8.822 48.479 4.829 40.416.913a5.533 5.533 0 0 0-4.146 0c-7.909 3.839-15.972 7.832-23.728 11.672l-9.751 4.837a4.119 4.119 0 0 0-2.688 3.763 4.061 4.061 0 0 0 2.688 3.916m59.817-3.225c-1.613.768-3.148 1.613-4.684 2.38l-2.534 1.229a1063.588 1063.588 0 0 1-16.279 7.986 2.12 2.12 0 0 1-1.536 0c-6.757-3.3-13.515-6.68-20.272-9.982l-4.3-2.15 17.047-8.447c2.611-1.305 5.222-2.611 7.832-3.839.268-.108.556-.16.845-.154 8.063 3.993 16.048 7.986 24.111 11.979l.921.461Z"
              />
              <path
                fill="#ffd600"
                d="M2.637 38.154a19132.396 19132.396 0 0 0 33.326 16.509c.495.224 1.01.403 1.537.535l.691.23.23.077.23-.077.691-.23c.55-.17 1.089-.376 1.613-.614 5.759-2.841 11.518-5.682 17.277-8.6l10.981-5.452c1.766-.845 3.532-1.689 5.222-2.611a3.939 3.939 0 0 0 2-4.838 3.882 3.882 0 0 0-4.454-2.611c-.7.162-1.372.42-2 .768l-3.611 1.846c-8.907 4.377-17.815 8.831-26.722 13.284a2.5 2.5 0 0 1-2.534 0A5805.147 5805.147 0 0 0 6.169 31.013c-2.3-1.152-4.607-.538-5.682 1.536a3.751 3.751 0 0 0-.307 2.995 5.054 5.054 0 0 0 2.457 2.611"
              />
              <path
                fill="#f5931e"
                d="M70.67 56.046a5941.672 5941.672 0 0 0-31.406 15.588 1.662 1.662 0 0 1-1.689 0 8859.35 8859.35 0 0 0-31.56-15.588 4.608 4.608 0 0 0-2.457-.537 3.756 3.756 0 0 0-3.379 3.3 3.847 3.847 0 0 0 2.38 4.3 5055.77 5055.77 0 0 0 33.633 16.664c.447.212.909.392 1.382.538.23.077.384.154.614.23l.23.077.23-.077c.23-.077.384-.154.614-.23.461-.154.921-.307 1.305-.461 11.213-5.531 22.424-11.131 33.635-16.663a5.276 5.276 0 0 0 1.612-1.228 4.037 4.037 0 0 0 0-4.991c-1.229-1.613-3.148-1.92-5.145-.921"
              />
              <path
                fill="#f5931e"
                d="m2.791 50.748 10.827 5.375c7.525 3.686 15.05 7.448 22.575 11.211.69.35 1.453.534 2.227.538.775.005 1.54-.18 2.227-.538 1.766-.921 3.532-1.766 5.3-2.688l7.6-3.763 20.5-10.136a4.1 4.1 0 0 0 2.611-3.686 3.884 3.884 0 0 0-1.689-3.379 4.583 4.583 0 0 0-4.454 0l-31.1 15.434c-.61.385-1.39.385-2 0-8.6-4.377-17.123-8.6-25.724-12.823l-5.368-2.686c-2.457-1.229-4.684-.61-5.759 1.459a3.6 3.6 0 0 0-.307 2.918 4.654 4.654 0 0 0 2.534 2.764"
              />
            </g>
          </svg>
        </>
      ) : (
        <></>
      )}
    </div>
  );
};

export default Loader;
